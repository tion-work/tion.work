<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TiON.Work ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .stats-display { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª TiON.Work ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š å½“å‰ç»Ÿè®¡æ•°æ®</h2>
            <div id="stats-display" class="stats-display">
                <p>æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</p>
            </div>
            <button class="button" onclick="refreshStats()">ğŸ”„ åˆ·æ–°ç»Ÿè®¡</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ› ï¸ æ¨¡æ‹Ÿå·¥å…·ä½¿ç”¨</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æ¨¡æ‹Ÿä¸åŒå·¥å…·çš„ä½¿ç”¨ï¼Œè§‚å¯Ÿç»Ÿè®¡æ•°æ®çš„å˜åŒ–ï¼š</p>
            <button class="button" onclick="simulateToolUse('json-formatter', true)">JSON æ ¼å¼åŒ–å™¨ (æˆåŠŸ)</button>
            <button class="button" onclick="simulateToolUse('base64-encoder', true)">Base64 ç¼–ç å™¨ (æˆåŠŸ)</button>
            <button class="button" onclick="simulateToolUse('password-generator', true)">å¯†ç ç”Ÿæˆå™¨ (æˆåŠŸ)</button>
            <button class="button" onclick="simulateToolUse('json-formatter', false)">JSON æ ¼å¼åŒ–å™¨ (å¤±è´¥)</button>
            <button class="button" onclick="simulateToolUse('css-minifier', true)">CSS å‹ç¼©å™¨ (æˆåŠŸ)</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ æ•°æ®ç®¡ç†</h2>
            <button class="button" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
            <button class="button" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤æ•°æ®</button>
            <button class="button" onclick="addSampleData()">ğŸ“ æ·»åŠ ç¤ºä¾‹æ•°æ®</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ å®æ—¶ç›‘æ§</h2>
            <div id="realtime-stats" class="stats-display">
                <p>å®æ—¶ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
            <button class="button" onclick="startRealtimeMonitoring()">â–¶ï¸ å¼€å§‹å®æ—¶ç›‘æ§</button>
            <button class="button" onclick="stopRealtimeMonitoring()">â¹ï¸ åœæ­¢ç›‘æ§</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ StatsManager ç±»
        class TestStatsManager {
            constructor() {
                this.storageKey = 'tion-work-stats';
                this.maxRecords = 10000;
            }

            recordToolUsage(toolId, success, processingTime) {
                const usage = {
                    toolId,
                    timestamp: Date.now(),
                    success,
                    processingTime,
                    userAgent: navigator.userAgent,
                };

                const existingData = this.getStoredData();
                existingData.push(usage);
                
                if (existingData.length > this.maxRecords) {
                    existingData.splice(0, existingData.length - this.maxRecords);
                }
                
                this.saveData(existingData);
                this.updateDisplay();
            }

            getStats() {
                const data = this.getStoredData();
                const now = Date.now();
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const todayStart = today.getTime();
                
                const weekAgo = now - 7 * 24 * 60 * 60 * 1000;
                const monthAgo = now - 30 * 24 * 60 * 60 * 1000;

                const totalUses = data.length;
                const todayUses = data.filter(usage => usage.timestamp >= todayStart).length;
                const thisWeekUses = data.filter(usage => usage.timestamp >= weekAgo).length;
                const thisMonthUses = data.filter(usage => usage.timestamp >= monthAgo).length;
                
                const successfulUses = data.filter(usage => usage.success);
                const successRate = totalUses > 0 ? (successfulUses.length / totalUses) * 100 : 0;
                
                const totalProcessingTime = data.reduce((sum, usage) => sum + usage.processingTime, 0);
                const averageTime = totalUses > 0 ? totalProcessingTime / totalUses : 0;

                const toolUsageCount = {};
                data.forEach(usage => {
                    toolUsageCount[usage.toolId] = (toolUsageCount[usage.toolId] || 0) + 1;
                });

                const popularTools = Object.entries(toolUsageCount)
                    .map(([toolId, uses]) => ({ id: toolId, name: toolId, uses }))
                    .sort((a, b) => b.uses - a.uses)
                    .slice(0, 10);

                const recentActivity = data
                    .slice(-10)
                    .reverse()
                    .map(usage => ({
                        toolId: usage.toolId,
                        toolName: usage.toolId,
                        timestamp: usage.timestamp,
                        success: usage.success,
                    }));

                return {
                    totalUses,
                    todayUses,
                    thisWeekUses,
                    thisMonthUses,
                    averageTime: Math.round(averageTime * 100) / 100,
                    successRate: Math.round(successRate * 100) / 100,
                    popularTools,
                    recentActivity,
                };
            }

            getStoredData() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Failed to parse stored stats data:', error);
                    return [];
                }
            }

            saveData(data) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(data));
                } catch (error) {
                    console.error('Failed to save stats data:', error);
                }
            }

            clearAllData() {
                localStorage.removeItem(this.storageKey);
                this.updateDisplay();
            }

            exportData() {
                const data = this.getStoredData();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tion-work-stats-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            updateDisplay() {
                const stats = this.getStats();
                const statsDisplay = document.getElementById('stats-display');
                
                statsDisplay.innerHTML = `
                    <h3>ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                        <div style="text-align: center; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #1976d2;">${stats.totalUses}</div>
                            <div style="font-size: 14px; color: #666;">æ€»ä½¿ç”¨æ¬¡æ•°</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #388e3c;">${stats.todayUses}</div>
                            <div style="font-size: 14px; color: #666;">ä»Šæ—¥ä½¿ç”¨</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #fff3e0; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #f57c00;">${stats.thisWeekUses}</div>
                            <div style="font-size: 14px; color: #666;">æœ¬å‘¨ä½¿ç”¨</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #fce4ec; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #c2185b;">${stats.successRate}%</div>
                            <div style="font-size: 14px; color: #666;">æˆåŠŸç‡</div>
                        </div>
                    </div>
                    
                    <h4>ğŸ† çƒ­é—¨å·¥å…·</h4>
                    <div style="margin: 10px 0;">
                        ${stats.popularTools.length > 0 ? 
                            stats.popularTools.map((tool, index) => 
                                `<div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee;">
                                    <span>${index + 1}. ${tool.name}</span>
                                    <span style="color: #666;">${tool.uses} æ¬¡</span>
                                </div>`
                            ).join('') : 
                            '<p style="color: #666;">æš‚æ— æ•°æ®</p>'
                        }
                    </div>
                    
                    <h4>ğŸ•’ æœ€è¿‘æ´»åŠ¨</h4>
                    <div style="margin: 10px 0;">
                        ${stats.recentActivity.length > 0 ? 
                            stats.recentActivity.slice(0, 5).map(activity => {
                                const timeAgo = Math.floor((Date.now() - activity.timestamp) / 1000);
                                const timeText = timeAgo < 60 ? `${timeAgo}ç§’å‰` : 
                                               timeAgo < 3600 ? `${Math.floor(timeAgo / 60)}åˆ†é’Ÿå‰` : 
                                               `${Math.floor(timeAgo / 3600)}å°æ—¶å‰`;
                                return `<div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee;">
                                    <span>${activity.toolName} - ${activity.success ? 'æˆåŠŸ' : 'å¤±è´¥'}</span>
                                    <span style="color: #666;">${timeText}</span>
                                </div>`;
                            }).join('') : 
                            '<p style="color: #666;">æš‚æ— æ´»åŠ¨</p>'
                        }
                    </div>
                `;
            }
        }

        const statsManager = new TestStatsManager();
        let monitoringInterval = null;

        // æ¨¡æ‹Ÿå·¥å…·ä½¿ç”¨
        function simulateToolUse(toolId, success) {
            const processingTime = Math.random() * 2 + 0.1; // 0.1-2.1 ç§’
            statsManager.recordToolUsage(toolId, success, processingTime);
            
            const status = success ? 'æˆåŠŸ' : 'å¤±è´¥';
            console.log(`âœ… æ¨¡æ‹Ÿä½¿ç”¨ ${toolId}: ${status} (${processingTime.toFixed(2)}s)`);
        }

        // åˆ·æ–°ç»Ÿè®¡
        function refreshStats() {
            statsManager.updateDisplay();
            console.log('ğŸ”„ ç»Ÿè®¡æ•°æ®å·²åˆ·æ–°');
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            statsManager.exportData();
            console.log('ğŸ“¥ æ•°æ®å·²å¯¼å‡º');
        }

        // æ¸…é™¤æ•°æ®
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ')) {
                statsManager.clearAllData();
                console.log('ğŸ—‘ï¸ æ•°æ®å·²æ¸…é™¤');
            }
        }

        // æ·»åŠ ç¤ºä¾‹æ•°æ®
        function addSampleData() {
            const tools = ['json-formatter', 'base64-encoder', 'password-generator', 'css-minifier', 'html-minifier'];
            const count = 20;
            
            for (let i = 0; i < count; i++) {
                const tool = tools[Math.floor(Math.random() * tools.length)];
                const success = Math.random() > 0.1; // 90% æˆåŠŸç‡
                const processingTime = Math.random() * 2 + 0.1;
                const timestamp = Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000; // æœ€è¿‘7å¤©
                
                const usage = {
                    toolId: tool,
                    timestamp,
                    success,
                    processingTime,
                    userAgent: navigator.userAgent,
                };
                
                const existingData = statsManager.getStoredData();
                existingData.push(usage);
                statsManager.saveData(existingData);
            }
            
            statsManager.updateDisplay();
            console.log(`ğŸ“ å·²æ·»åŠ  ${count} æ¡ç¤ºä¾‹æ•°æ®`);
        }

        // å¼€å§‹å®æ—¶ç›‘æ§
        function startRealtimeMonitoring() {
            if (monitoringInterval) return;
            
            monitoringInterval = setInterval(() => {
                const stats = statsManager.getStats();
                const realtimeDisplay = document.getElementById('realtime-stats');
                
                realtimeDisplay.innerHTML = `
                    <h4>ğŸ“ˆ å®æ—¶ç»Ÿè®¡</h4>
                    <p><strong>æ€»ä½¿ç”¨æ¬¡æ•°:</strong> ${stats.totalUses}</p>
                    <p><strong>ä»Šæ—¥ä½¿ç”¨:</strong> ${stats.todayUses}</p>
                    <p><strong>æˆåŠŸç‡:</strong> ${stats.successRate}%</p>
                    <p><strong>å¹³å‡å¤„ç†æ—¶é—´:</strong> ${stats.averageTime}ç§’</p>
                    <p><strong>æœ€åæ›´æ–°:</strong> ${new Date().toLocaleTimeString()}</p>
                `;
            }, 1000);
            
            console.log('â–¶ï¸ å®æ—¶ç›‘æ§å·²å¼€å§‹');
        }

        // åœæ­¢å®æ—¶ç›‘æ§
        function stopRealtimeMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                console.log('â¹ï¸ å®æ—¶ç›‘æ§å·²åœæ­¢');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            statsManager.updateDisplay();
            console.log('ğŸš€ ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>